# 타이핑 퀴즈 - 서술형 문제 암기 도우미 TODO

## Phase 1: 프로젝트 계획 수립
- [ ] TODO 리스트 작성 및 기능 명세 정리

## Phase 2: 데이터베이스 스키마 설계
- [x] 과목(Subject) 테이블 설계
- [x] 문제(Question) 테이블 설계
- [x] 연습 기록(PracticeSession) 테이블 설계
- [x] 시험 기록(TestSession) 테이블 설계
- [x] 망각 곡선 데이터(ReviewSchedule) 테이블 설계
- [x] 데이터베이스 마이그레이션 실행

## Phase 3: 디자인 시스템 및 레이아웃
- [x] Elegant 스타일 커러 팔레트 정의 (index.css)
- [x] 타이포그래피 및 폰트 설정
- [x] DashboardLayout 기반 네비게이션 구조 설정
- [x] 공통 컴포넌트 스타일 정의

## Phase 4: 과목 및 문제 관리
- [x] 과목 목록 페이지 구현
- [x] 과목 생성/수정/삭제 기능
- [x] 문제 목록 페이지 구현
- [x] 문제 생성/수정/삭제 기능 (질문 + 답안)
- [x] 과목별 문제 필터링 기능

## Phase 5: 연습 모드
- [x] 연습 모드 페이지 UI 구현
- [x] 실시간 타이핑 비교 로직 (문자 단위 비교)
- [x] 오타 하이라이트 표시
- [x] 타이핑 속도 측정 (WPM, CPM)
- [x] 연습 시간 및 반복 횟수 기록
- [x] 연습 세션 저장 기능

## Phase 6: 시험 모드
- [x] 시험 모드 페이지 UI 구현
- [x] 빈칸 답안 작성 인터페이스
- [x] 답안 제출 및 채점 로직
- [x] 자주 틀린 부분 하이라이트
- [x] 정답률 계산
- [x] 회상 소요 시간 측정
- [x] 시험 결과 저장 기능

## Phase 7: LLM 기반 답안 평가
- [x] LLM API 통합 (의미적 유사도 평가)
- [x] 키워드 누락 분석 로직
- [x] 논리적 오류 지적 기능
- [x] 개선 제안 생성 기능
- [x] 평가 결과 UI 표시

## Phase 8: 음성 입력 기능
- [x] 음성 녹음 인터페이스 구현
- [x] 음성 파일 S3 업로드
- [x] Whisper API 통합 (음성-텍스트 변환)
- [x] 변환된 텍스트 답안 입력 연동

## Phase 9: 학습 통계 및 시각화
- [x] 학습 통계 대시보드 페이지
- [x] 시간당 평균 암기량 계산
- [x] 시간당 평균 망각량 계산
- [x] 망각 곡선 그래프 (Recharts)
- [x] 예상 학점 계산 로직
- [x] 통계 데이터 시각화

## Phase 10: 망각 곡선 기반 알림
- [x] 망각 곡선 알고리즘 구현 (SM-2 알고리즘)
- [x] 복습 스케줄 자동 생성
- [x] 복습 마감 문제 알림 기능
- [x] 홈 페이지에 복습 알림 UI 표시

## Phase 11: 통합 테스트
- [x] 주요 기능 Vitest 테스트 작성
- [x] 전체 워크플로우 테스트
- [x] 체크포인트 생성

## Phase 12: 결과 전달
- [ ] 사용자에게 완성된 웹앱 전달
- [ ] 사용 가이드 제공


---

# 사용자 피드백 기반 개선 사항 (v1.1)

## Phase 1: 과목 관리 개선
- [x] 과목 순서(위치) 변경 기능 (드래그 앤 드롭)
- [x] 과목 삭제 버그 수정 (optimistic update 적용)

## Phase 2: 연습 모드 UX 개선
- [x] 정확도 측정 기능 제거
- [x] 오타 수 통계 제거
- [x] 띠어쓰기 관대 처리 (틀려도 채점에 영향 없음)
- [x] 시작 버튼 제거 - 문제 보면 바로 연습 시작
- [x] 1분간 입력 없으면 시간 측정 중단
- [x] 실시간 통계 표시 제거 (진행률, CPM, 정확도, 경과 시간, 오타 수)
- [x] 측정 상태 표시등 추가 (초록불: 측정 중, 빨간불: 중단)
- [x] 타이핑 시각 피드백 개선:
  - [x] 모범 답안 하이라이트 대신 입력할 부분에 언더바
  - [x] 입력 전: 회색 글자
  - [x] 올바르게 입력: 검정색으로 채워짐
  - [x] 틀린 입력: 빨간색 표시
  - [x] 입력 중에는 색상 변화 없이 편안하게

## Phase 3: 이미지 첨부 및 라벨링 기능
- [x] 문제에 이미지 첨부 기능 추가
- [x] 이미지 업로드 및 S3 저장
- [x] 드래그로 영역 선택 기능
- [ ] AI 기반 이미지 텍스트 인식 (OCR) - 추후 추가 예정
- [x] 수동 영역 지정 인터페이스
- [ ] 연습/시험 모드에서 이미지 라벨 표시

## Phase 4: AI 채점 선택적 옵션화
- [x] 기본 채점 방식: 문자열/규칙 기반으로 변경
- [x] AI 채점 토글 옵션 추가 (문제별 useAIGrading 필드)
- [x] AI 채점 크레딧 시스템 구현 (users.aiCreditBalance)
- [x] AI 채점 크레딧 차감 로직
- [ ] AI 채점 결과 캐싱 (같은 답안 재평가 방지) - 추후 추가
- [ ] AI 채점 사용 통계 대시보드 - 추후 추가


---

# 버그 수정 (v1.1.1)
- [x] 과목 클릭 시 404 오류 발생 문제 수정
- [x] 라우팅 설정 확인 및 수정

# UI 개선 (v1.1.2)
- [x] 연습 모드 정답 폰트 두껋게 (text-xl font-semibold)
- [x] 현재 입력 위치만 두껋운 언더바 표시 (border-b-4)
- [x] 입력 중 색상 변화 제거 (글자 완성 후에만 색상 표시)

# UI 추가 개선 (v1.1.3)
- [x] 불필요한 얗은 언더바 제거 (다음 입력 글자 외)
- [x] 한글 조합 중 색상 변화 방지 (compositionstart/end 이벤트 사용)
- [x] 키보드 단축키 추가 (Ctrl+Enter: 완료, Esc: 나가기)

# 버그 수정 (v1.1.4)
- [x] 연습 모드 채점 로직 수정
  - [x] 글자 단위로 즉시 채점 (단어 전체가 아닌)
  - [x] 이미 완성된 글자는 색상 유지 (lastCompletedLength 추적)
  - [x] 현재 입력 중인 글자만 회색 표시
  - [x] 색상이 깜박이지 않도록 안정화

# UI 추가 수정 (v1.1.5)
- [x] 입력 칸 커서 표시 (animate-pulse 적용)
- [x] 언더바가 글자 완성 후에만 다음으로 이동 (lastCompletedLength 기반)

# 로직 수정 (v1.1.6)
- [x] 언더바 이동 로직 개선 - 정답 글자 완성 시 즉시 다음으로 이동

# 버그 수정 (v1.1.7)
- [x] compositionEnd 로직 수정 - 정답 글자 완성 시 언더바 즉시 이동 (for loop로 모든 정답 글자 확인)

# 전체 재구현 (v1.2.0)
- [x] 언더바 이동 로직 완전 수정 (normalizedInput.length 기반)
- [x] 조합 중 색상 변화 완전 차단 (!isComposing 조건)
- [x] 커서 표시 수정 (textarea에 caret-foreground 클래스)
- [x] 입력/삭제 모두 정상 작동하도록 전체 로직 단순화

# 버그 수정 (v1.2.1)
- [x] 글자 단위 즉시 채점 구현 - completedLength 상태로 조합 완료된 글자만 채점

# 버그 수정 (v1.2.2)
- [x] 이미지 문제 생성 버그 수정
  - [x] 이미지 탭 선택 시 텍스트 탭으로 돌아가는 문제 (activeTab 상태 추가)
  - [x] 이미지 업로드 후 탭 상태 유지 (value/onValueChange 적용)
  - [x] 이미지 문제 질문 입력 필드 독립적으로 작동 (동일 formData.question 사용)

# 버그 수정 (v1.2.3)
- [x] 이미지 업로드 시 무한 루프 오류 수정
  - [x] ImageLabelEditor useEffect에 onChange dependency 추가
  - [x] Questions 페이지 onChange를 useCallback으로 감싸기
  - [x] setState 무한 호출 방지

# 버그 수정 (v1.2.4)
- [x] 이미지 업로드 무한 루프 오류 재수정
  - [x] ImageLabelEditor useEffect 제거
  - [x] onChange를 labels 변경 시점에만 직접 호출
  - [x] useCallback 제거 (일반 함수로 변경)

# 성능 개선 (v1.2.5)
- [x] 이미지 업로드 속도 개선
  - [x] 클라이언트 측 이미지 압축 추가 (browser-image-compression)
  - [x] 파일 크기 제한 (16MB → 2MB 압축)
  - [x] 이미지 해상도 제한 (1920px)
  - [x] Web Worker 사용으로 메인 스레드 차단 방지
- [x] 질문 입력 필드 끊김 현상 해결
  - [x] ImageLabelEditor를 React.memo로 최적화
  - [x] 불필요한 리렌더링 방지
  - [x] formData 상태 업데이트 최적화

# 버그 수정 (v1.2.6)
- [x] 이미지 문제 생성 시 answer 필드 오류 해결
  - [x] 서버 스키마에서 answer 필드를 optional로 변경
  - [x] 이미지 문제 생성 시 answer 기본값 처리
  - [x] 클라이언트에서 이미지 문제 생성 시 answer 필드 처리
  - [x] imageUrl, imageLabels 필드 스키마에 추가

# 버그 수정 (v1.2.7)
- [x] 입력 필드 끊김 현상 완전 해결
  - [x] textarea를 controlled input에서 uncontrolled로 변경 (useRef 사용)
  - [x] useCallback으로 handleCreate 메모이제이션
  - [x] 불필요한 리렌더링 방지
  - [x] resetForm에서 ref 초기화 추가

# 기능 추가 (v1.3.0)
- [x] 이미지 문제 연습/시험 모드 구현
  - [x] Practice.tsx에서 이미지 표시 및 라벨 입력 필드 렌더링
  - [x] Test.tsx에서 이미지 표시 및 라벨 입력 필드 렌더링
  - [x] 이미지 위 좌표에 번호 표시 및 영역 강조
  - [ ] 답안 채점 로직에 이미지 라벨 답안 처리 추가

# 버그 수정 및 개선 (v1.3.1)
- [x] 이미지 로딩 속도 개선
  - [x] 이미지 로딩 중 스켈레톤 UI 추가
  - [x] lazy loading 구현
  - [x] 이미지 로드 상태 표시
- [x] 연습 모드 404 에러 수정
  - [x] 완료 버튼 클릭 시 라우팅 오류 수정
  - [x] 뒤로가기 버튼 클릭 시 라우팅 오류 수정
- [x] 시험 모드 답안 노출 문제 해결
  - [x] 시험 모드에서 이미지 라벨 영역 표시 숨김
  - [x] 암기 시간에만 라벨 영역 표시
  - [x] 답안 작성 시에는 이미지만 표시

# 버그 수정 (v1.3.2)
- [x] 이미지 라벨 편집기 정답 입력 끊김 현상 해결
  - [x] ImageLabelEditor의 input을 uncontrolled로 변경 (defaultValue + onBlur)
  - [x] onChange를 onBlur로 변경하여 입력 완료 시점에만 상태 업데이트
- [x] 시험 모드 라벨 영역 표시 문제 해결
  - [x] 암기 시간(!isStarted)에는 라벨 영역 표시
  - [x] 답안 작성 시(isStarted)에는 라벨 영역 숨김
  - [x] imageLoaded 상태와 함께 체크하여 이미지 로드 후 라벨 표시

# 기능 추가 및 개선 (v1.4.0)
- [x] 시험 모드 라벨 영역 불투명 박스 처리
  - [x] 암기 시간에 불투명한 박스로 정답 영역 가리기
  - [x] 박스 중앙에 큰 흰색 번호 라벨링 추가
  - [x] 박스 색상 및 투명도 조정
- [x] 시험 모드 제출 버튼 활성화 로직
  - [x] 이미지 라벨 답안 입력 시 제출 버튼 활성화
  - [x] 텍스트 답안과 동일한 로직 적용
  - [x] 모든 라벨 영역 답안 입력 확인 후 제출 가능
- [x] 연습 모드 플래시카드 버전 구현
  - [x] 타이핑 모드: 기존 정답 입력 방식 유지
  - [x] 플래시카드 모드: 박스 클릭 시 정답 표시
  - [x] 모드 전환 UI 추가 (상단 토글 버튼)
  - [x] 플래시카드 모드에서 학습 진행 상태 표시 (n/total)

# 플래시카드 개선 및 버그 수정 (v1.4.1)
- [x] 연습 모드 플래시카드 개선
  - [x] 타이핑 모드 제거, 플래시카드 모드만 유지
  - [x] 박스를 완전 불투명(bg-black)으로 변경
  - [x] 정답 텍스트를 이미지 외부에 별도 표시
  - [x] 클릭 시 공개/가리기 토글 기능
- [x] 시험 모드 버그 수정
  - [x] 암기 시간에 라벨 영역을 완전 불투명 박스(bg-black)로 가리기
  - [x] 이미지 중복 표시는 정상 동작 (암기 시간/답안 작성 시간 별도 표시)

# 시험 모드 버그 수정 (v1.4.2)
- [x] 시험 시작 후 이미지 중복 표시 문제 해결
  - [x] 시험 시작 전에만 문제 카드 표시
  - [x] 답안 작성 시 문제 텍스트를 답안 카드 내부에 표시
- [x] 이미지 문제 채점 오류 수정
  - [x] 서버 채점 로직에서 이미지 라벨 답안 처리 추가
  - [x] imageLabels에서 정답을 추출하여 채점
  - [x] LLM 평가 프롬프트에도 correctAnswer 사용

# 버그 수정 (v1.4.3)
- [ ] 시험 모드 암기 시간에 가림막 박스가 표시되지 않는 문제 해결
  - [ ] Test.tsx에서 암기 시간(!isStarted) 조건 확인
  - [ ] 이미지 라벨 영역에 불투명 박스 렌더링 확인

# 버그 수정 및 UX 개선 (v1.4.4)
- [ ] 시험 모드 가림막 박스 미표시 문제 해결
  - [ ] Test.tsx에서 암기 시간(!isStarted)에 불투명 박스 표시 확인
  - [ ] imageLabels 파싱 및 렌더링 로직 검증
- [x] 채점 결과 표시 오류 수정
  - [x] 이미지 문제 채점 시 답안 텍스트 표시 (imageLabels.map으로 라벨별 표시)
  - [x] 모범 답안 박스 스타일 수정 (bg-green-50 → bg-muted/50 + border-green-500/30)
- [x] 문제 추가 다이얼로그 크기 확대
  - [x] 다이얼로그 최대 너비를 max-w-6xl로 증가
  - [x] 이미지 라벨 편집기 영역 확대
- [x] ImageLabelEditor Tab 키 네비게이션
  - [x] Tab 키 입력 시 다음 라벨 답안 입력 필드로 포커스 이동
  - [x] Shift+Tab으로 이전 필드 이동
  - [x] data-label-id 속성으로 필드 식별 및 포커스 이동

# 버그 수정 (v1.4.5)
- [x] 이미지 문제 채점 로직 오류 수정
  - [x] 정답 여부, 유사도, 정확도가 0%로 표시되는 문제 해결
  - [x] fallback 로직에서 question.answer 대신 correctAnswer 변수 사용
  - [x] imageLabels에서 추출한 correctAnswer가 fallback에서도 유지되도록 수정

# 버그 수정 (v1.4.6)
- [x] 이미지 문제 채점 로직 디버깅
  - [x] 서버 로그에서 correctAnswer 값 확인
  - [x] useAIGrading 플래그 확인
  - [x] 문자열 비교 로직 검증
- [x] 이미지 문제 라벨별 채점 로직 구현
  - [x] 각 라벨별로 개별 비교 (imageLabels[i].answer vs userAnswerLines[i])
  - [x] 라벨별 정답 여부 계산
  - [x] 전체 정확도 = (맞은 라벨 수 / 전체 라벨 수) * 100
  - [x] 피드백 메시지에 "맞은 개수/전체 개수" 표시

# 버그 수정 (v1.4.7)
- [x] 시험 모드 암기 시간에 불투명 박스가 표시되지 않는 문제 해결
  - [x] Test.tsx에서 !isStarted 조건 확인
  - [x] imageLabels 파싱 및 렌더링 로직 검증
  - [x] 불투명 박스 스타일 및 위치 확인
  - [x] 283번 줄에 !isStarted 조건 추가하여 암기 시간에만 박스 표시

# 버그 수정 (v1.4.8)
- [x] 시험 모드에서 시작 버튼을 눌러도 불투명 박스가 계속 유지되도록 수정
  - [x] Test.tsx에서 !isStarted 조건 제거
  - [x] 암기 시간과 답안 작성 시간 모두 불투명 박스 표시
  - [x] 답안 작성 시간에 이미지 위에 불투명 박스 추가
  - [x] 음성 입력 기능을 텍스트 문제에만 표시

# 버그 수정 (v1.4.9)
- [x] 홈 대시보드 전체 문제 수 표시 오류 수정
  - [x] 현재 22개로 표시되지만 실제로는 6개 (총의치 4개, 해부 2개)
  - [x] 홈 페이지 통계 쿼리 로직 확인
  - [x] 문제 수 카운트 로직 수정
  - [x] 데이터베이스에서 불필요한 문제 삭제
  - [x] countQuestionsByUserId 함수 추가
  - [x] questions.count 프로시저 추가

# 기능 추가 (v1.5.0)
- [x] 학습 통계 페이지 개선
  - [x] 총 연습 시간 표시
  - [x] 과목별 연습 시간 표시
  - [x] 통계 초기화 버튼 추가
  - [x] 연습 세션에 시간 기록 추가 (시작 시간, 종료 시간)
  - [x] 통계 초기화 API 구현
  - [x] 통계 페이지 UI 업데이트
  - [x] practice.deleteAll 프로시저 추가
  - [x] test.deleteAll 프로시저 추가
  - [x] deleteAllPracticeSessions 함수 추가
  - [x] deleteAllTestSessions 함수 추가
  - [x] 통계 초기화 테스트 작성 및 통과

# 기능 추가 (v1.5.1)
- [x] 이미지 문제에 타이핑 연습용 메모장 추가
  - [x] Practice 페이지에서 이미지 문제 감지
  - [x] 이미지 하단에 메모장 textarea 추가
  - [x] 메모장 내용은 저장하지 않고 연습용으로만 사용
  - [x] practiceNote state 추가
  - [x] 정답 목록 아래에 메모장 UI 배치

# 기능 개선 (v1.5.2)
- [x] Practice 페이지 이미지 문제 레이아웃 개선
  - [x] "박스를 클릭하여 정답을 확인하세요" 섹션 제거
  - [x] 이미지와 메모장을 2단 레이아웃으로 배치 (grid-cols-1 lg:grid-cols-2)
  - [x] 메모장을 보면서 이미지를 동시에 볼 수 있도록 개선
  - [x] 메모장 높이를 400px로 증가
- [x] ESC 키 동작 수정
  - [x] ESC 키를 완료 버튼과 동일하게 작동 (통계 저장 후 나가기)
  - [x] Ctrl+Enter도 완료 버튼과 동일하게 작동
  - [x] 기존 "나가기" 동작 제거
  - [x] 단축키 안내 텍스트 업데이트

# 버그 수정 (v1.5.3)
- [x] Practice 페이지 ESC 키 작동하지 않는 문제 수정
  - [x] 전역 키보드 이벤트 리스너 추가
  - [x] 이미지 문제에서도 ESC 키 감지되도록 수정
  - [x] useEffect로 window keydown 이벤트 등록
  - [x] handleGlobalKeyDown 함수 추가

# 기능 개선 (v1.6.0)
- [x] 앱 이름 및 브랜딩 변경
  - [x] 홈페이지 타이틀을 "타이핑 퀴즈"에서 "numbering.pro"로 변경
  - [x] 설명 문구를 "넘버링 달인, 그림빵 장인 되기"로 변경
  - [x] index.html title 태그 업데이트
  - [x] Home.tsx 타이틀 및 설명 업데이트

# 버그 수정 (v1.6.1)
- [x] 시험 통계 저장 및 채점 로직 수정
  - [x] 시험을 쳐도 시험 횟수가 통계에 잡히지 않는 문제
  - [x] 올바르게 입력해도 유사도 정확도가 0%로 표시되는 문제
  - [x] 정답 여부가 항상 X로 표시되는 문제
  - [x] Test.tsx의 결과 저장 로직 확인
  - [x] 서버 채점 로직 확인
  - [x] AI 채점을 사용하지 않는 경우에도 createTestSession 호출하도록 수정
  - [x] 이미지 문제 채점 후 testSession 저장 추가
  - [x] 텍스트 문제 채점 후 testSession 저장 추가

# 기능 개선 (v1.6.2)
- [x] 시험 결과 화면에 정답과 오답 비교 표시
  - [x] 서버 채점 로직에 단어별/문자별 비교 정보 추가
  - [x] 정답과 사용자 답안을 나란히 표시
  - [x] 다른 부분을 색상으로 강조 (정답: 초록색, 오답: 빠른색)
  - [x] 이미지 문제의 각 라벨별 비교 표시
  - [x] 텍스트 문제의 전체 답안 비교 표시
  - [x] labelComparisons 데이터 구조 추가
  - [x] Test.tsx 결과 화면 UI 업데이트

# 버그 수정 (v1.6.3)
- [x] 텍스트 연습에서 입력을 시작하면 언더바가 사라지는 문제 수정
  - [x] Practice 페이지 텍스트 입력 부분 확인
  - [x] 언더바 표시 조건 확인
  - [x] 입력 중에도 언더바가 유지되도록 수정
  - [x] 196번 줄에서 !isComposing 조건 제거

# 버그 수정 (v1.6.4)
- [x] 언더바가 정답 글자 일치 시에만 다음으로 이동하도록 수정
  - [x] 현재는 입력 길이만 보고 언더바가 이동
  - [x] 정답 글자와 일치할 때만 언더바 다음으로 이동
  - [x] completedLength를 정답 일치 기준으로 업데이트
  - [x] handleCompositionEnd에서 정답 글자 수만 계산
  - [x] 언더바 위치를 completedLength 기준으로 변경

# 버그 수정 (v1.6.5)
- [x] 정답에 줄바꾸기가 있을 때 채점 지연 문제 수정
  - [x] renderTextWithFeedback 함수의 성능 최적화
  - [x] 줄바꾸기 처리 로직 확인
  - [x] useMemo로 renderTextWithFeedback 메모이제이션
  - [x] 실시간 채점 반영 지연 원인 파악 및 수정

# 버그 수정 (v1.6.6)
- [x] 한 글자 틀렸을 때 이후 글자들도 채점되도록 수정
  - [x] handleCompositionEnd에서 틀린 글자 이후도 계속 채점
  - [x] completedLength 업데이트 로직 개선
  - [x] break 문 제거
  - [x] 단순 입력 길이로 completedLength 설정
